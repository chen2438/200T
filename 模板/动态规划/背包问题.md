## 01背包

### AcWing 2. 01背包问题

![image-20230227163956761](https://media.opennet.top/i/2023/02/27/63fc6c5e2fa95.png)

#### 代码

##### 朴素

```cpp
#include<bits/stdc++.h>
#define FOR(i,a,b) for(int i=(a);i<=(b);++i)
using namespace std;

const int N = 1010;

int n, m;
int v[N], w[N];
int f[N][N];

int main(){
    cin >> n >> m;
    FOR(i,1,n) cin >> v[i] >> w[i];
    FOR(i,1,n)
        FOR(j,0,m){
            f[i][j] = f[i-1][j];
            if(j-v[i]>=0) f[i][j] = max(f[i-1][j], f[i-1][j-v[i]] + w[i]);
        }
    cout << f[n][m] << endl;
    return 0;
}
```

##### 空间优化

```cpp
#include<bits/stdc++.h>
#define FOR(i,a,b) for(int i=(a);i<=(b);++i)
#define ROF(i,a,b) for(int i=(a);i>=(b);--i)
using namespace std;

const int N = 1010;

int n, m;
int v[N], w[N];
int f[N];

int main(){
    cin >> n >> m;
    FOR(i,1,n) cin >> v[i] >> w[i];
    FOR(i,1,n)
        ROF(j,m,0){
            if(j-v[i]>=0) f[j] = max(f[j], f[j-v[i]] + w[i]);
        }
    cout << f[m] << endl;
    return 0;
}
```



(变种)[P1802 5 倍经验日](https://www.luogu.com.cn/problem/P1802)
```cpp
#include<bits/stdc++.h>
#define FOR(i,a,b) for(int i=(a);i<=(b);++i)
#define ROF(i,a,b) for(int i=(a);i>=(b);--i)
using namespace std;

int win[1100],lose[1100],use[1100],dp[1100];

int main(){
    int n,m;
    cin>>n>>m;
    FOR(i,1,n)
    	cin>>lose[i]>>win[i]>>use[i];
    FOR(i,1,n){
        ROF(j,m,0){
         	if(j>=use[i]) dp[j]=max(dp[j]+lose[i],dp[j-use[i]]+win[i]);
          	else dp[j]+=lose[i];
        }
    }
    cout<<5ll*dp[m];
    return 0;
}
```

### D. Make Them Equal

https://codeforces.com/problemset/problem/1633/D

#### 题意

![image-20220816160736127](http://nme-200t.oss-cn-hangzhou.aliyuncs.com/notes/2022-08-16-080736.png)

https://zhuanlan.zhihu.com/p/463438157

![image-20230227171411178](https://media.opennet.top/i/2023/02/27/63fc7465a8ba6.png)

#### 思路1

![image-20220816160804277](http://nme-200t.oss-cn-hangzhou.aliyuncs.com/notes/2022-08-16-080805.png)

补图（可能不是原思路）：

![image-20230227171431969](https://media.opennet.top/i/2023/02/27/63fc7478dfeea.png)

#### 思路2

预处理的操作也可以用dp完成

#### 代码1

```cpp
#pragma GCC optimize(3)
#include<bits/stdc++.h>
#define FOR(i,a,b) for(int i=(a);i<=(b);++i)
#define ROF(i,a,b) for(int i=(a);i>=(b);--i)
#define mem(a) memset((a),0,sizeof(a))
#define endl '\n'
// #define int long long
using namespace std;

struct node{
    int idx,step;
};

const int INF = 0x3f3f3f3f;
const int N = 1e3+7, K=1e6+7;
int rom[N];
int b[N],c[N];
int f[K],v[N],w[N];

void bfs(){
    queue<node> q;
    q.push({1,0});
    int cnt=1;
    while(!q.empty()){
        auto t=q.front(); q.pop();
        if(t.idx>1000) continue;
        if(rom[t.idx]) continue;
        if(cnt>1000) break;
        cnt++;
        rom[t.idx]=t.step;
        FOR(i,1,t.idx){
            q.push({t.idx+t.idx/i,t.step+1});
        }
    }
}

int dp(int n,int k){
    FOR(i,0,k) f[i]=0;
    FOR(i,1,n) v[i]=rom[b[i]];
    FOR(i,1,n) w[i]=c[i];
    FOR(i,1,n)
        ROF(j,k,0){
            if(j-v[i]>=0) f[j] = max(f[j], f[j-v[i]] + w[i]);
        }
    return f[k];
}

void solve(){
    int n,k; cin>>n>>k;
    k=min(k,12*n);//1800ms->30ms
    FOR(i,1,n) cin>>b[i];
    FOR(i,1,n) cin>>c[i];
    int ans=dp(n,k);
    cout<<ans<<endl;
}

signed main(){
    cin.tie(0)->sync_with_stdio(0);
    int T=1; cin>>T;
    bfs();
    while(T--) solve();
    return 0;
}
```

#### 代码2

```cpp
#pragma GCC optimize(3)
#include<bits/stdc++.h>
#define FOR(i,a,b) for(int i=(a);i<=(b);++i)
#define ROF(i,a,b) for(int i=(a);i>=(b);--i)
#define mem(a) memset((a),0,sizeof(a))
#define endl '\n'
// #define int long long
using namespace std;

struct node{
    int idx,step;
};

const int INF = 0x3f3f3f3f;
const int N = 1e3+7, K=1e6+7;
int rom[N];
int b[N],c[N];
int f[K],v[N],w[N];

void init(){
    memset(rom,0x3f,sizeof rom);
    rom[1]=0;
    FOR(i,1,1000){
        FOR(j,1,i){
            if(i+i/j>1000) continue;
            rom[i+i/j]=min(rom[i+i/j],rom[i]+1);
        }
    }
}

int dp(int n,int k){
    FOR(i,0,k) f[i]=0;
    FOR(i,1,n) v[i]=rom[b[i]];
    FOR(i,1,n) w[i]=c[i];
    FOR(i,1,n)
        ROF(j,k,0){
            if(j-v[i]>=0) f[j] = max(f[j], f[j-v[i]] + w[i]);
        }
    return f[k];
}

void solve(){
    int n,k; cin>>n>>k;
    k=min(k,12*n);
    FOR(i,1,n) cin>>b[i];
    FOR(i,1,n) cin>>c[i];
    int ans=dp(n,k);
    cout<<ans<<endl;
}

signed main(){
    cin.tie(0)->sync_with_stdio(0);
    int T=1; cin>>T;
    init();
    while(T--) solve();
    return 0;
}
```



## 完全背包

### AcWing 3. 完全背包问题

https://www.acwing.com/problem/content/3/

![image-20230227171658321](https://media.opennet.top/i/2023/02/27/63fc750b660e0.png)

#### 代码

##### 朴素

复杂度:  $O(N^3)$

```cpp
#include<bits/stdc++.h>
#define FOR(i,a,b) for(int i=(a);i<=(b);++i)
using namespace std;

const int N = 1010;

int n, m;
int v[N], w[N];
int dp[N][N];

int main(){
    cin >> n >> m;
    FOR(i,1,n) cin >> v[i] >> w[i];
    FOR(i,1,n)
        FOR(j,0,m){
            for(int k=0;j-k*v[i]>=0;k++){
                dp[i][j]=max(dp[i][j],dp[i-1][j-k*v[i]]+k*w[i]);
            }
        }
    cout << dp[n][m] << endl;
    return 0;
}
```

##### 时间优化

```cpp
#include<bits/stdc++.h>
#define FOR(i,a,b) for(int i=(a);i<=(b);++i)
using namespace std;

const int N = 1010;

int n, m;
int v[N], w[N];
int dp[N][N];

int main(){
    cin >> n >> m;
    FOR(i,1,n) cin >> v[i] >> w[i];
    FOR(i,1,n)
        FOR(j,0,m){
            dp[i][j] = dp[i-1][j];
            if(j-v[i]>=0) dp[i][j] = max(dp[i][j], dp[i][j - v[i]] + w[i]);
        }
    cout << dp[n][m] << endl;
    return 0;
}
```

##### 时间+空间优化

```cpp
#include<bits/stdc++.h>
#define FOR(i,a,b) for(int i=(a);i<=(b);++i)
using namespace std;

const int N = 1010;

int n, m;
int v[N], w[N];
int dp[N];

int main(){
    cin >> n >> m;
    FOR(i,1,n) cin >> v[i] >> w[i];
    FOR(i,1,n)
        FOR(j,0,m)
            if(j-v[i]>=0) dp[j] = max(dp[j], dp[j - v[i]] + w[i]);
    cout << dp[m] << endl;
    return 0;
}
```

## 多重背包

### AcWing 4. 多重背包问题 I

https://www.acwing.com/problem/content/4/

![image-20230227171727815](https://media.opennet.top/i/2023/02/27/63fc75294050e.png)

#### 代码

```cpp
#include<bits/stdc++.h>
#define FOR(i,a,b) for(int i=(a);i<=(b);++i)
using namespace std;

const int N = 110;

int n, m;
int v[N], w[N], s[N];
int f[N][N];

int main(){
    cin >> n >> m;
    FOR(i,1,n) cin >> v[i] >> w[i] >> s[i];
    
    FOR(i,1,n)
    FOR(j,0,m)
    FOR(k,0,s[i])
        if(j-k*v[i]>=0) f[i][j] = max(f[i][j], f[i-1][j-v[i]*k]+w[i]*k);
    
    cout << f[n][m] << endl;
    return 0;
}
```



### AcWing 5. 多重背包问题 II

![image-20230227171803726](https://media.opennet.top/i/2023/02/27/63fc754d3e9c1.png)

#### 代码

##### 二进制优化

```cpp
#include<bits/stdc++.h>
#define FOR(i,a,b) for(int i=(a);i<=(b);++i)
#define ROF(i,a,b) for(int i=(a);i>=(b);--i)
using namespace std;

const int N = 12010, M = 2010;

int n, m;
int v[N], w[N];
int f[M];

int main(){
    cin >> n >> m;
    int cnt = 0;
    FOR(i,1,n){
        int V, W, S; cin >> V >> W >> S;
        int k = 1;
        while (k <= S){
            cnt ++ ;
            v[cnt] = V * k;
            w[cnt] = W * k;
            S -= k;
            k *= 2;
        }
        if (S > 0){
            cnt ++ ;
            v[cnt] = V * S;
            w[cnt] = W * S;
        }
    }
    n = cnt;
    FOR(i,1,n)
        ROF(j,m,0)
            if(j-v[i]>=0) f[j] = max(f[j], f[j - v[i]] + w[i]);
            
    cout << f[m] << endl;
    return 0;
}
```

## 分组背包

### AcWing 9. 分组背包问题

https://www.acwing.com/problem/content/9/

![image-20230227171838589](https://media.opennet.top/i/2023/02/27/63fc756fd24b3.png)

![image-20230227171857653](https://media.opennet.top/i/2023/02/27/63fc758270266.png)



#### 代码

```cpp
#include<bits/stdc++.h>
#define FOR(i,a,b) for(int i=(a);i<=(b);++i)
#define ROF(i,a,b) for(int i=(a);i>=(b);--i)
using namespace std;

const int N = 110;

int n, m;
int v[N][N], w[N][N], s[N];
int f[N];

int main(){
    cin >> n >> m;
    FOR(i,1,n){
        cin >> s[i];
        FOR(j,0,s[i]-1) cin >> v[i][j] >> w[i][j];
    }
    FOR(i,1,n)
    ROF(j,m,0)
    FOR(k,0,s[i]-1)
        if(j-v[i][k]>=0) f[j] = max(f[j], f[j-v[i][k]]+w[i][k]);
    cout << f[m] << endl;
    return 0;
}
```

