## 带修改莫队

### AcWing 2521. 数颜色

#### 题目描述

![image-20220810131418686](http://nme-200t.oss-cn-hangzhou.aliyuncs.com/notes/2022-08-10-051419.png)

![image-20220810131425937](http://nme-200t.oss-cn-hangzhou.aliyuncs.com/notes/2022-08-10-051426.png)

#### 代码

```cpp
#pragma GCC optimize(3)
#include<bits/stdc++.h>
#define FOR(i,a,b) for(int i=(a);i<=(b);++i)
#define ROF(i,a,b) for(int i=(a);i>=(b);--i)
#define endl '\n'
using namespace std;

const int N = 10010, S = 1000010;

int n, m, mq, mc, len;
int w[N], cnt[S], ans[N], bel[N];

struct Query{
    int id, l, r, t;
}q[N];

struct Modify{
    int p, c;
}c[N];

bool cmp(const Query& a, const Query& b){
    int al = bel[a.l], ar = bel[a.r];
    int bl = bel[b.l], br = bel[b.r];
    if (al != bl) return al < bl;
    if (ar != br) return ar < br;
    return a.t < b.t;
}

void add(int x, int& res){
    if (!cnt[x]) res ++ ;
    cnt[x] ++ ;
}

void del(int x, int& res){
    cnt[x] -- ;
    if (!cnt[x]) res -- ;
}

int main(){
    cin>>n>>m;
    FOR(i,1,n) cin>>w[i];
    FOR(i,0,m-1){
        char op[2];
        int a, b;
        cin>>op>>a>>b;
        if (*op == 'Q') mq ++, q[mq] = {mq, a, b, mc};
        else c[ ++ mc] = {a, b};
    }
    len = cbrt((double)n * max(1 , mc)) + 1;
    FOR(i,1,n) bel[i]=i/len;
    sort(q + 1, q + mq + 1, cmp);
    for (int i = 0, j = 1, t = 0, k = 1, res = 0; k <= mq; k ++ ){
        int id = q[k].id, l = q[k].l, r = q[k].r, tm = q[k].t;
        while (i < r) add(w[ ++ i], res);
        while (i > r) del(w[i -- ], res);
        while (j < l) del(w[j ++ ], res);
        while (j > l) add(w[ -- j], res);
        while (t < tm){
            t ++ ;
            if (c[t].p >= j && c[t].p <= i){
                del(w[c[t].p], res);
                add(c[t].c, res);
            }
            swap(w[c[t].p], c[t].c);
        }
        while (t > tm){
            if (c[t].p >= j && c[t].p <= i){
                del(w[c[t].p], res);
                add(c[t].c, res);
            }
            swap(w[c[t].p], c[t].c);
            t -- ;
        }
        ans[id] = res;
    }
    FOR(i,1,mq) cout<<ans[i]<<endl;
    return 0;
}
```

