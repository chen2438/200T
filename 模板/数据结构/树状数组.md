## AcWing 241. 楼兰图腾

![image-20220627230801540](https://nme-200t.oss-cn-hangzhou.aliyuncs.com/template/202206272308592.png)

![image-20220627230818415](https://nme-200t.oss-cn-hangzhou.aliyuncs.com/template/202206272308459.png)

### 待完善

## 单点修改、区间查询

[P3374 【模板】树状数组 1](https://www.luogu.com.cn/problem/P3374)

![image-20220627222447689](https://nme-200t.oss-cn-hangzhou.aliyuncs.com/template/202206272224796.png)

c[x] 是以 x 结尾, 长度是 $2^k$ 的区间和

`c[x] = sum( a[x-lowbit(x)+1 -> x] )`

`c[x] = a[x]+c[x-1]+c[x-1-lowbit(x-1)] + ...` 

```cpp
#include<bits/stdc++.h>
#define FOR(i,a,b) for(int i=(a);i<=(b);++i)
#define elif else if
using namespace std;

int a[500100],c[500100],n,m;

int lowbit(int x){
    return x&-x;
}

void add(int x,int v){
    while(x<=n)
        c[x]+=v,x+=lowbit(x);
}

int sum(int x){
    int ans=0;
    while(x>=1)
        ans+=c[x],x-=lowbit(x);
    return ans;
}

int SUM(int l,int r){
    return sum(r)-sum(l-1);
}

int main(){
    ios_base::sync_with_stdio(0);
    cin.tie(0);
    int i,cmd,x,y;
    cin>>n>>m;
    FOR(i,1,n)
        cin>>a[i],add(i,a[i]);
    while(m--){
        cin>>cmd>>x>>y;
        if(cmd==1) add(x,y);
        elif(cmd==2) cout<<SUM(x,y)<<'\n';
    }
    return 0;
}
```

## 区间修改、单点查询

[P3368 【模板】树状数组 2](https://www.luogu.com.cn/problem/P3368)

```cpp
#include<bits/stdc++.h>
#define FOR(i,a,b) for(int i=(a);i<=(b);++i)
#define elif else if
using namespace std;

int a[500100],c[500100],n,m;

int lowbit(int x){
    return x&-x;
}

void add(int x,int v){
    while(x<=n)
        c[x]+=v,x+=lowbit(x);
}

int query(int x){
    int ans=0;
    while(x>=1)
        ans+=c[x],x-=lowbit(x);
    return ans;
}

int main(){
    ios_base::sync_with_stdio(0);
    cin.tie(0);
    int cmd,x,y,k;
    cin>>n>>m;
    int past=0,now;
    FOR(i,1,n){
        cin>>now;
        add(i,now-past);
        past=now;
    } 
    while(m--){
        cin>>cmd;
        if(cmd==1){
            cin>>x>>y>>k;
            add(x,k);
            add(y+1,-k);
        }
        elif(cmd==2){
            cin>>x;
            cout<<query(x)<<'\n';
        }
    }
    return 0;
}
```

## 区间最值

```cpp
#include<bits/stdc++.h>
#define FOR(i,a,b) for(int i=(a);i<=(b);++i)
using namespace std;

struct BIT{
    #define MAXN (int)2e7+7
    #define INF (int)1e9+7
    #define maxs(a,b) ((a)>(b)?(a):(b))
    #define mins(a,b) ((a)<(b)?(a):(b))
    struct node{
        int val,i;//数值,原始下标
        bool operator<(const node &x)const{
            return val<x.val;
        }
        bool operator>(const node &x)const{
            return val>x.val;
        }
    };
    int n;
    node v[MAXN],mi[MAXN],ma[MAXN];
    int lowbit(int x){
        return x&(-x);
    }
    void update(int x){
        v[x].i=x;
        while(x<=n){
            mi[x]=ma[x]=v[x];
            int lowx=lowbit(x);
            for(int i=1;i<lowx;i<<=1){
                mi[x]=mins(mi[x],mi[x-i]);
                ma[x]=maxs(ma[x],ma[x-i]);
            }
            x+=lowbit(x);
        }       
    }
    node qmin(int l,int r){//查最小值
        node ans=(node){INF,0};
        while(r>=l){
            ans=min(ans,v[r]);
            for(r=r-1;r-lowbit(r)>=l;r-=lowbit(r))
                ans=min(ans,mi[r]);
        }
        return ans;
    }
    node qmax(int l,int r){//查最大值
        node ans=(node){-INF,0};
        while(r>=l){
            ans=max(ans,v[r]);
            for(r=r-1;r-lowbit(r)>=l;r-=lowbit(r))
                ans=max(ans,ma[r]);
        }
        return ans;
    }
}tr;

int main(){
    //cin.tie(0)->sync_with_stdio(0);
    int m;
    cin>>tr.n>>m;
    FOR(i,1,tr.n){
        cin>>tr.v[i].val;
        tr.update(i);
    }
    int x,y;
    FOR(i,1,m){
        cin>>x>>y;
        cout<<"min.val="<<tr.qmin(x,y).val<<'\n';
        cout<<"min.i="<<tr.qmin(x,y).i<<'\n';
        cout<<"max.val="<<tr.qmax(x,y).val<<'\n';
        cout<<"max.i="<<tr.qmax(x,y).i<<'\n';
    }
    return 0;
}
```

